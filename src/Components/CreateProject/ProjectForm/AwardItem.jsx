import React, {useState} from 'react';
import s from "./ProjectForm.module.sass";
import {
  CheckboxInput,
  CheckInput,
  NumberInput,
  PhoneInputMask,
  TextAreaInput,
  TextInput
} from "../../Common/Form/Form";
import emptyImg from './../../../../src/assets/images/image.svg'
import {readFileAsUrl} from "../../../handlers/fileReader";


const AwardItem = ({index, award, arrayHelpers, setFieldValue}) => {
  const [edit, setEdit] = useState(award.new || false)
  return (
    <div className={[s.formBlock, s.award].join(' ')}>
      <div className={s.awardFilled}>
        <div className={[s.awardFilledItem].join(' ')}>
          <h3>Вознаграждение</h3>
          <TextInput
            className={[s.awardName, s.formRow].join(' ')}
            name={`awards.${index}.name`}
            label="Название вознаграждения"
            disabled={!edit}
            counter="60"
          />
          <TextAreaInput
            label="Описание вознаграждения"
            className={[s.awardDesc, s.formRow].join(' ')}
            name={`awards.${index}.description`}
            disabled={!edit}
            counter="300"
          />
          <div className={s.awardImg}>
            <h4>Изображение награды (не&nbsp;обязательно)</h4>
            <div className="form-row form-row-file">
              <input type="file"
                     name={`awards.${index}.image_base64`}
                     accept=".png, .jpg, .jpeg, .bmp"
                     className="form-award-input"
                     id={`awards.${index}.image_base64`}
                     disabled={!edit}
                     onChange={(e) => {
                       let files = e.currentTarget.files;
                       if (!files.length) return;

                       if (files.length > 1) {
                         alert('Максимум 1 изображение');
                         return;
                       }
                       readFileAsUrl(files[0]).then(url => {
                         const image = new Image();
                         image.src = url;
                         image.onload = function () {
                           const height = this.height;
                           const width = this.width;
                           if (width < 600 || height < 338) {
                             alert("Минимальное разрешение 600×338 пикселей");
                             return false;
                           }
                           setFieldValue(`awards.${index}.image_base64`, url);
                         }
                       })
                     }}
              />
              <div className={s.awardImgBox}>
                <div className={[s.awardImgPic, s.awardImgPicFilled].join(' ')}>
                  <img src={award.image_base64 ? award.image_base64 : emptyImg} alt={award.name}/>
                </div>
              </div>
              <div className="form-file-explain">
                <div className="form-file-desc">Прикрепить JPEG, PNG или BMP. Не более 5 МБ. Минимальное
                  разрешение 600×338 пикселей (16:9).
                </div>
                <label className="form-file-label button blue"
                       htmlFor={`awards.${index}.image_base64`} disabled={!edit}>Прикрепить</label>
              </div>
            </div>
          </div>
          <div className={s.awardDonation}>
            <NumberInput
              name={`awards.${index}.amount_ton`}
              label="Сумма пожертвования"
              disabled={!edit}
            />
          </div>
          <div className={s.awardDelivery}>
            <h3>Доставка</h3>
            <CheckboxInput
              name={`awards.${index}.need_delivery`}
              label="Потребуется доставка"
              disabled={!edit}
            />
            {
              award.need_delivery
              &&
              <>
                <div className={s.checkboxList}>
                  <CheckInput
                    name={`awards.${index}.ask_contact_info`}
                    disabled={!edit}
                    label="Запросить адрес доставки"
                  />
                  <CheckInput
                    name={`awards.${index}.is_pickup_available`}
                    disabled={!edit}
                    label="Доступен самовывоз"
                  />
                </div>
                <div className={s.awardPickup}>
                  <h4>Самовывоз</h4>
                  <TextInput
                    name={`awards.${index}.pickup_info`}
                    label="Адрес и условия самовывоза"
                    disabled={!edit}
                    className={s.formRow}
                    desc='Например: Россия, г. Москва, ул. Мира, д. 12, кв. 67. Забрать вознаграждение можно будет с 9:00 до 17:00'
                    text={award.pickup_info}
                    descClassName={s.description}
                  />
                </div>
                <div className={s.awardPhone}>
                  <PhoneInputMask
                    name={`awards.${index}.phone_number`}
                    label="Телефон"
                    disabled={!edit}
                    className={[s.formRow, 'tel-row'].join(' ')}
                  />
                </div>
              </>
            }
          </div>
          <div className={["button-row", s.formButtons].join(' ')}>
            <button type="button" className={s.delete} onClick={() => arrayHelpers.remove(index)}>
              <svg width="15px" height="17px" viewBox="0 0 15 17" xmlns="http://www.w3.org/2000/svg">
                <path fill="#777777"
                      d="M8.6171875,0 C9.2109375,0 9.67578125,0.15625 10.0117188,0.46875 C10.3476562,0.78125 10.515625,1.21354167 10.515625,1.765625 L10.515,2.875 L13.84375,2.875 C13.9770833,2.875 14.0945833,2.9125 14.19625,2.9875 L14.2695312,3.05078125 C14.3867188,3.16796875 14.4453125,3.30989583 14.4453125,3.4765625 C14.4453125,3.65364583 14.3867188,3.80078125 14.2695312,3.91796875 C14.1523438,4.03515625 14.0104167,4.09375 13.84375,4.09375 L12.9921875,4.09375 L12.4921875,14.78125 C12.4609375,15.3333333 12.2773438,15.7708333 11.9414062,16.09375 C11.6054688,16.4166667 11.1640625,16.578125 10.6171875,16.578125 L3.828125,16.578125 C3.28125,16.578125 2.83984375,16.4179688 2.50390625,16.0976562 C2.16796875,15.7773438 1.984375,15.3411458 1.953125,14.7890625 L1.453125,4.09375 L0.6015625,4.09375 C0.440104167,4.09375 0.299479167,4.03515625 0.1796875,3.91796875 C0.0598958333,3.80078125 0,3.65364583 0,3.4765625 C0,3.30989583 0.0598958333,3.16796875 0.1796875,3.05078125 C0.299479167,2.93359375 0.440104167,2.875 0.6015625,2.875 L3.921,2.875 L3.921875,1.765625 C3.921875,1.27488426 4.05459105,0.878793724 4.32002315,0.577353395 L4.42578125,0.46875 C4.76171875,0.15625 5.22395833,0 5.8125,0 Z M11.703125,4.09375 L2.7109375,4.09375 L3.21875,14.6171875 C3.22916667,14.8307292 3.30338542,15.0065104 3.44140625,15.1445312 C3.57942708,15.2825521 3.75260417,15.3515625 3.9609375,15.3515625 L10.4765625,15.3515625 C10.6901042,15.3515625 10.8658854,15.2838542 11.0039062,15.1484375 C11.1419271,15.0130208 11.2161458,14.8359375 11.2265625,14.6171875 L11.703125,4.09375 Z M4.8125,5.3828125 C4.953125,5.3828125 5.06770833,5.42447917 5.15625,5.5078125 C5.24479167,5.59114583 5.29166667,5.703125 5.296875,5.84375 L5.5234375,13.6640625 C5.52864583,13.7994792 5.48567708,13.9101562 5.39453125,13.9960938 C5.30338542,14.0820312 5.18489583,14.125 5.0390625,14.125 C4.89322917,14.125 4.77734375,14.0833333 4.69140625,14 C4.60546875,13.9166667 4.55989583,13.8046875 4.5546875,13.6640625 L4.328125,5.8515625 C4.328125,5.7109375 4.37109375,5.59765625 4.45703125,5.51171875 C4.54296875,5.42578125 4.66145833,5.3828125 4.8125,5.3828125 Z M7.2265625,5.3828125 C7.37239583,5.3828125 7.49088542,5.42578125 7.58203125,5.51171875 C7.67317708,5.59765625 7.71875,5.70833333 7.71875,5.84375 L7.71875,13.6640625 C7.71875,13.8046875 7.67317708,13.9166667 7.58203125,14 C7.49088542,14.0833333 7.37239583,14.125 7.2265625,14.125 C7.08072917,14.125 6.9609375,14.0833333 6.8671875,14 C6.7734375,13.9166667 6.7265625,13.8046875 6.7265625,13.6640625 L6.7265625,5.84375 C6.7265625,5.70833333 6.7734375,5.59765625 6.8671875,5.51171875 C6.9609375,5.42578125 7.08072917,5.3828125 7.2265625,5.3828125 Z M9.6328125,5.3828125 C9.78385417,5.3828125 9.90234375,5.42578125 9.98828125,5.51171875 C10.0742188,5.59765625 10.1171875,5.7109375 10.1171875,5.8515625 L9.890625,13.671875 C9.88541667,13.8072917 9.83984375,13.9166667 9.75390625,14 C9.66796875,14.0833333 9.55208333,14.125 9.40625,14.125 C9.26041667,14.125 9.14322917,14.0820312 9.0546875,13.9960938 C8.96614583,13.9101562 8.921875,13.7994792 8.921875,13.6640625 L9.1484375,5.8515625 C9.15364583,5.70572917 9.20052083,5.59114583 9.2890625,5.5078125 C9.37760417,5.42447917 9.4921875,5.3828125 9.6328125,5.3828125 Z M8.53125,1.171875 L5.8984375,1.171875 C5.69010417,1.171875 5.52083333,1.23177083 5.390625,1.3515625 C5.26041667,1.47135417 5.1953125,1.63020833 5.1953125,1.828125 L5.195,2.875 L9.234,2.875 L9.234375,1.828125 C9.234375,1.66979167 9.19354167,1.53645833 9.111875,1.428125 L9.04296875,1.3515625 C8.91536458,1.23177083 8.74479167,1.171875 8.53125,1.171875 Z"></path>
              </svg>
              <span>Удалить</span>
            </button>
            {!edit
              ? <button type="button" className={s.edit} onClick={() => setEdit(true)}>
                <svg version="1.1" width="17px" height="17px" viewBox="0 0 17 17" xmlns="http://www.w3.org/2000/svg">
                  <path fill="#777777"
                        d="M8.06005859,0 C9.16129557,0 10.1988932,0.208902995 11.1728516,0.626708984 C12.1468099,1.04451497 13.0045573,1.62556966 13.7460938,2.36987305 C14.4876302,3.11417643 15.0700684,3.97330729 15.4934082,4.94726562 C15.916748,5.92122396 16.128418,6.95882161 16.128418,8.06005859 C16.128418,9.16682943 15.9181315,10.2058105 15.4975586,11.177002 C15.0769857,12.1481934 14.495931,13.0045573 13.7543945,13.7460938 C13.0128581,14.4876302 12.1551107,15.0700684 11.1811523,15.4934082 C10.207194,15.916748 9.16959635,16.128418 8.06835938,16.128418 C6.96158854,16.128418 5.92260742,15.916748 4.95141602,15.4934082 C3.98022461,15.0700684 3.12386068,14.4876302 2.38232422,13.7460938 C1.64078776,13.0045573 1.05834961,12.1481934 0.635009766,11.177002 C0.211669922,10.2058105 0,9.16682943 0,8.06005859 C0,6.95882161 0.210286458,5.92122396 0.630859375,4.94726562 C1.05143229,3.97330729 1.63387044,3.11417643 2.37817383,2.36987305 C3.12247721,1.62556966 3.98022461,1.04451497 4.95141602,0.626708984 C5.92260742,0.208902995 6.95882161,0 8.06005859,0 Z M8.06005859,1.47753906 C7.14697266,1.47753906 6.29337565,1.64632161 5.49926758,1.98388672 C4.70515951,2.32145182 4.00651042,2.79182943 3.40332031,3.39501953 C2.80013021,3.99820964 2.3297526,4.69824219 1.9921875,5.49511719 C1.6546224,6.29199219 1.48583984,7.14697266 1.48583984,8.06005859 C1.48583984,8.97314453 1.6546224,9.828125 1.9921875,10.625 C2.3297526,11.421875 2.80013021,12.1219076 3.40332031,12.7250977 C4.00651042,13.3282878 4.70654297,13.8000488 5.50341797,14.1403809 C6.30029297,14.4807129 7.15527344,14.6508789 8.06835938,14.6508789 C8.98144531,14.6508789 9.83780924,14.4807129 10.6374512,14.1403809 C11.4370931,13.8000488 12.1371257,13.3282878 12.7375488,12.7250977 C13.337972,12.1219076 13.8083496,11.421875 14.1486816,10.625 C14.4890137,9.828125 14.6564128,8.97314453 14.6508789,8.06005859 C14.6508789,7.14697266 14.4807129,6.29199219 14.1403809,5.49511719 C13.8000488,4.69824219 13.3282878,3.99820964 12.7250977,3.39501953 C12.1219076,2.79182943 11.421875,2.32145182 10.625,1.98388672 C9.828125,1.64632161 8.97314453,1.47753906 8.06005859,1.47753906 Z M9.71191406,5.40380859 L10.6748047,6.375 L5.59472656,11.4467773 L4.50732422,11.8535156 C4.4132487,11.8922526 4.32747396,11.8728841 4.25,11.7954102 C4.17252604,11.7179362 4.15315755,11.6266276 4.19189453,11.5214844 L4.64013672,10.4755859 L9.71191406,5.40380859 Z M11.1687012,4.16699219 C11.3153483,4.15592448 11.4495443,4.21402995 11.5712891,4.34130859 L11.7456055,4.515625 C11.8728841,4.64290365 11.932373,4.77848307 11.9240723,4.92236328 C11.9157715,5.06624349 11.8452148,5.20458984 11.7124023,5.33740234 L11.1479492,5.91015625 L10.1850586,4.93896484 L10.7578125,4.37451172 C10.8850911,4.24723307 11.022054,4.1780599 11.1687012,4.16699219 Z"></path>
                </svg>
                <span>Редактировать</span>
              </button>
              : <button type="button" className="save button white" onClick={() => setEdit(false)}>
                <span>Сохранить</span>
              </button>
            }
          </div>
        </div>
      </div>
    </div>
  );
};

export default AwardItem;
